# Upbit Autobot

## 소개
Upbit Autobot은 업비트 거래소에서 여러 코인을 동시에 자동매매할 수 있는 **고급 멀티코인 트레이딩 봇**입니다.  
수익률, 변동성, 거래량, 이동평균, RSI, 볼린저밴드 등 다양한 기술적 지표와 트레일링 스탑, 리밸런싱, 시장상황 분기 등  
실전 자동매매에 필요한 전략을 모두 반영하며,  
실시간 반응형 대시보드(웹)와 텔레그램 알림, 상태 저장/복구 등 운영 편의성까지 갖춘 완전 자동화 시스템입니다.

---

## 주요 기능

- **고급 전략 기반 포트폴리오 자동 선정**  
  - 수익률, 변동성, 거래량, 이동평균(MA), RSI, 볼린저밴드 등 다양한 지표를 조합해  
    매 루프마다 최적의 포트폴리오를 자동 선정
- **트레일링 스탑 및 자동 리밸런싱**  
  - 매수 후 10% 이상 수익 발생 시 고점 대비 5% 이상 하락하면 자동 매도  
  - 새 포트폴리오에 없는 기존 보유 코인은 자동 전량 매도
- **시장 상황별 전략 분기**  
  - 전체 시장이 하락장(-5% 이하)일 때는 현금 비중 80% 유지, RSI 30 이하 종목만 소액 매수  
  - 정상장에서는 분산 포트폴리오 적극 매수
- **멀티코인/코인별 독립 상태 관리**  
  - 각 코인별로 매수가, 보유수량, 최근 매매시각, 체결상태, 매매횟수 등 독립 관리
- **실시간 반응형 대시보드**  
  - Streamlit 기반 웹 대시보드에서 코인별 상태를 실시간 모니터링 (PC/모바일 모두 지원)
- **알림 및 예외처리**  
  - 텔레그램 알림, API 예외처리, 매매횟수 제한, 최소 주문금액 등 실전 운영 안전장치 내장
  - **이메일 발송**: 거래/운영 중 문제가 발생할 때만 관리자에게 이메일로 알림 발송
- **상태 저장/복구 및 거래내역 파일 저장**  
  - 코인별 상태를 파일로 저장, 프로그램 재시작 시 자동 복구
  - 모든 매매 거래내역을 별도 파일(csv 등)로 저장하여 추후 분석 및 백업 가능
- **자동 실행 및 서버 운영 최적화**  
  - run_both.py로 자동매매와 대시보드를 한 번에 실행, tmux/systemd 등으로 항상 운영 가능

---

## 폴더/파일 구조

```
upbit-autobot/
├── .env
├── src/
│   ├── main.py
│   ├── run_both.py
│   ├── dashboard_streamlit.py
│   ├── upbit_api.py
│   ├── telegram_alert.py
│   ├── coin_states.json
│   ├── trade_history.csv
│   └── templates/
│       └── status.html
```

---

## 환경설정

1. **.env 파일 작성**
    ```
    UPBIT_ACCESS_KEY=...
    UPBIT_SECRET_KEY=...
    TELEGRAM_BOT_TOKEN=...
    TELEGRAM_CHAT_ID=...
    EMAIL_HOST=...
    EMAIL_PORT=...
    EMAIL_USER=...
    EMAIL_PASS=...
    EMAIL_TO=...
    ```

2. **필수 패키지 설치**
    ```bash
    pip install -r requirements.txt
    ```

---

## 실행 방법

1. **자동매매 및 대시보드 동시 실행**
    ```bash
    cd src
    python run_both.py
    ```
2. **웹 대시보드 접속**
    - 브라우저에서 [http://localhost:8501](http://localhost:8501) 접속

3. **항상 실행(서버/클라우드)**
    - tmux, systemd 등으로 run_both.py를 등록하면 서버 재부팅 후에도 자동 실행

---

## 사용된 전략 상세

### 1. **다중 지표 기반 스코어링**
- **수익률**: 30일간 가격 상승률
- **변동성**: 30일간 가격 표준편차
- **거래량**: 30일간 평균 거래대금
- **이동평균(MA5, MA20)**: 단기/장기 추세 비교
- **볼린저밴드**: 20일 기준 상하단 돌파 신호
- **RSI**: 14일 기준 과매수/과매도 신호
- 각 지표를 가중합하여 종목별 score 산출, 상위 N개 종목을 포트폴리오로 선정

### 2. **트레일링 스탑**
- 매수 후 10% 이상 수익 발생 시, 고점 대비 5% 이상 하락하면 자동 매도

### 3. **시장 상황별 분기**
- 전체 시장 평균 수익률이 -5% 이하(하락장)일 때는 현금 80% 유지, RSI 30 이하 종목만 소액 매수
- 정상장에서는 분산 포트폴리오 적극 매수

### 4. **자동 리밸런싱**
- 새로 선정된 포트폴리오에 없는 기존 보유 코인은 자동 전량 매도

### 5. **리스크 관리**
- 1일 최대 매매 횟수 제한(기본 10회)
- 최소 기대수익률 미만, 최소 주문금액 미만, 30분 이내 중복매매 방지 등

---

## 장점

- **실전 자동매매에 필요한 모든 기능 내장**
- **고급 전략과 리스크 관리의 결합**
- **실시간 모니터링 및 운영 편의성**
- **확장성(전략 추가, 알림, 백테스트 등) 용이**
- **반응형 웹 대시보드로 모바일/PC 모두 지원**
- **자동 실행 및 서버 운영 최적화**
- **문제 발생 시 이메일로 즉시 알림, 거래내역 파일 저장으로 투명한 기록 관리**

---

## 참고/주의사항

- **실제 자산이 거래되므로 반드시 소액으로 충분히 테스트 후 사용하세요.**
- API 키 등 민감 정보는 외부에 노출되지 않도록 주의하세요.
- coin_states.json, .env, trade_history.csv 파일은 .gitignore에 추가하세요.
- 실매매 전에는 페이퍼트레이딩(모의매매)로 충분히 검증하세요.

---

## 향후 발전 방향

- 클래스 기반 구조, 포트폴리오 리밸런싱, 고급 리스크 관리, 실시간 파라미터 변경,  
  체결/미체결 관리, 대시보드 고도화, 거래내역 분석 및 시각화 등 전문 트레이딩 시스템으로 확장
